# –†–µ—Ñ–ª–µ–∫—Å–∏—è: MARKUP-001 ‚Äî –°–∏—Å—Ç–µ–º–∞ —Ä—É—á–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏ –±–ª–æ–∫–æ–≤

**–î–∞—Ç–∞**: 2026-01-18  
**–£—Ä–æ–≤–µ–Ω—å**: 3 (Intermediate Feature)  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ COMPLETE

---

## –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä—É—á–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ StoryEngine:
- –ù–æ–≤—ã–π —Ç–∏–ø –±–ª–æ–∫–∞ `unmarked` –¥–ª—è –Ω–µ—Ä–∞–∑–º–µ—á–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è `empty` ‚Üí `unmarked` –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–æ–≤
- –†–∞–∑–º–µ—Ç–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ BubbleMenu
- –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω –∏–∑ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- –ü–µ—Ä–µ–Ω–æ—Å –±–ª–æ–∫–∞ —Ü–µ–ª–∏–∫–æ–º –≤ –Ω–æ–≤—É—é —Å—Ü–µ–Ω—É

---

## –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –¢–∏–ø –±–ª–æ–∫–∞ `unmarked`
- –î–æ–±–∞–≤–ª–µ–Ω –≤ `SemanticBlockType` enum
- –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ `SemanticBlockView`:
  - –ú–µ—Ç–∫–∞ "–ù–µ—Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã–π"
  - –ë—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ —Ç–∏–ø–æ–≤ (–¥–∏–∞–ª–æ–≥, –æ–ø–∏—Å–∞–Ω–∏–µ, –¥–µ–π—Å—Ç–≤–∏–µ, –º—ã—Å–ª–∏)
  - –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–Ω–æ—Å–∞ –≤ –Ω–æ–≤—É—é —Å—Ü–µ–Ω—É (üé¨)

### 2. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ (Toolbar)
- **–ß–∏—Å—Ç—ã–π ‚Üí –°–∏–Ω—Ç–∞–∫—Å–∏—Å**: `empty` –±–ª–æ–∫–∏ —Å —Ç–µ–∫—Å—Ç–æ–º –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ `unmarked`
- **–°–∏–Ω—Ç–∞–∫—Å–∏—Å ‚Üí –ß–∏—Å—Ç—ã–π**: –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø—É—Å—Ç–æ–π `unmarked` –±–ª–æ–∫ –≤ –∫–æ–Ω–µ—Ü (–µ—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–ª–æ–∫ –Ω–µ unmarked)
- –ö—É—Ä—Å–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ –∫–æ–Ω–µ—Ü

### 3. –†–∞–∑–º–µ—Ç–∫–∞ —á–µ—Ä–µ–∑ BubbleMenu
- –ö–Ω–æ–ø–∫–∏ —Ä–∞–∑–º–µ—Ç–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ `unmarked` –±–ª–æ–∫–æ–≤ –≤ —Ä–µ–∂–∏–º–µ –°–∏–Ω—Ç–∞–∫—Å–∏—Å
- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏: –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≤—ã—Ä–µ–∑–∞–µ—Ç—Å—è –∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤—ã–π –±–ª–æ–∫ –Ω—É–∂–Ω–æ–≥–æ —Ç–∏–ø–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å —Å—Ü–µ–Ω—É" ‚Äî –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ –Ω–æ–≤—É—é —Å—Ü–µ–Ω—É

### 4. –ü–µ—Ä–µ–Ω–æ—Å –≤ –Ω–æ–≤—É—é —Å—Ü–µ–Ω—É
- –ò–∑ BubbleMenu: –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç ‚Üí –Ω–æ–≤–∞—è —Å—Ü–µ–Ω–∞ —Å `unmarked` –±–ª–æ–∫–æ–º
- –ò–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –±–ª–æ–∫–∞: –≤–µ—Å—å –±–ª–æ–∫ ‚Üí –Ω–æ–≤–∞—è —Å—Ü–µ–Ω–∞
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤ (–Ω–µ —Å–∫–ª–µ–∏–≤–∞–µ—Ç—Å—è –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É)

---

## –ß—Ç–æ –ø–æ—à–ª–æ —Ö–æ—Ä–æ—à–æ

1. **–ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥** ‚Äî –∫–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª—è–ª–∞—Å—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
2. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `node.content` –≤–º–µ—Å—Ç–æ `textContent` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤
3. **–ì–∏–±–∫–∞—è –ª–æ–≥–∏–∫–∞ —Ä–µ–∂–∏–º–æ–≤** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–ª–æ–∫–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ
4. **–ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ** ‚Äî BubbleMenu –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, –∑–∞–≥–æ–ª–æ–≤–æ–∫ –±–ª–æ–∫–∞ –¥–ª—è –≤—Å–µ–≥–æ –±–ª–æ–∫–∞

---

## –°–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. AI —Ä–∞–∑–º–µ—Ç–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞ –Ω–∞–¥—ë–∂–Ω–æ
- **–ü—Ä–æ–±–ª–µ–º–∞**: OpenAI –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–ª —Ç–µ–∫—Å—Ç, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–ª –±–ª–æ–∫–∏
- **–†–µ—à–µ–Ω–∏–µ**: –ü–æ–ª–Ω—ã–π –æ—Ç–∫–∞–∑ –æ—Ç AI –≤ –ø–æ–ª—å–∑—É —Ä—É—á–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏

### 2. –¢–µ–∫—Å—Ç —Å–∫–ª–µ–∏–≤–∞–ª—Å—è –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ
- **–ü—Ä–æ–±–ª–µ–º–∞**: `node.textContent` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –±–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `node.content` –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è Fragment —Å –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞–º–∏

### 3. –ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç –ø–æ–ø–∞–¥–∞–ª –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±–ª–æ–∫–∏
- **–ü—Ä–æ–±–ª–µ–º–∞**: –í Clean —Ä–µ–∂–∏–º–µ —Ç–µ–∫—Å—Ç –¥–æ–±–∞–≤–ª—è–ª—Å—è –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–ª–æ–∫
- **–†–µ—à–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ `unmarked` –±–ª–æ–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤ Clean —Ä–µ–∂–∏–º

### 4. Unmarked —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –≤—Å–µ–≥–¥–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
- **–ü—Ä–æ–±–ª–µ–º–∞**: –î–∞–∂–µ –µ—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–ª–æ–∫ —É–∂–µ unmarked
- **–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ `lastBlockType !== 'unmarked'` –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º

---

## –£—Ä–æ–∫–∏

1. **AI ‚â† –≤—Å–µ–≥–¥–∞ –ª—É—á—à–µ** ‚Äî –¥–ª—è —Ç–æ—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º —Ä—É—á–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥—ë–∂–Ω–µ–µ
2. **–°–æ—Ö—Ä–∞–Ω—è–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É** ‚Äî –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Tiptap –∏—Å–ø–æ–ª—å–∑—É–π `content` Fragment, –∞ –Ω–µ `textContent`
3. **–ü—Ä–æ–≤–µ—Ä—è–π —Å–æ—Å—Ç–æ—è–Ω–∏–µ** ‚Äî –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞ –ø—Ä–æ–≤–µ—Ä—è–π, –Ω—É–∂–µ–Ω –ª–∏ –æ–Ω
4. **–ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞** ‚Äî –¥–æ–±–∞–≤–ª—è–π —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ –æ–¥–Ω–æ–π, —Ç–µ—Å—Ç–∏—Ä—É–π –∫–∞–∂–¥—É—é

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

### –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –±–ª–æ–∫–∞
```typescript
// –ü–ª–æ—Ö–æ ‚Äî —Å–∫–ª–µ–∏–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç
const text = node.textContent;

// –•–æ—Ä–æ—à–æ ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É
const blockContent = node.content;
schema.nodes.semanticBlock.create(attrs, blockContent);
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–ª–æ–∫–∞
```typescript
doc.descendants((node) => {
  if (node.type.name === 'scene') {
    node.descendants((child) => {
      if (child.type.name === 'semanticBlock') {
        lastBlockType = child.attrs.blockType;
      }
    });
  }
});
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã —Å –±–ª–æ–∫–æ–º
```typescript
const newScene = schema.nodes.scene.create(
  { title: '–ù–æ–≤–∞—è —Å—Ü–µ–Ω–∞' },
  schema.nodes.semanticBlock.create(
    { blockType: 'unmarked' },
    content // Fragment –∏–ª–∏ –º–∞—Å—Å–∏–≤ nodes
  )
);
```

---

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|-----------|
| `SemanticBlock.ts` | –î–æ–±–∞–≤–ª–µ–Ω —Ç–∏–ø `unmarked`, Enter shortcut |
| `SemanticBlockView.tsx` | UI –¥–ª—è unmarked –±–ª–æ–∫–æ–≤, –∫–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–Ω–æ—Å–∞ |
| `BubbleMenu.tsx` | –ö–Ω–æ–ø–∫–∏ —Ä–∞–∑–º–µ—Ç–∫–∏, —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã |
| `Toolbar.tsx` | –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤ |

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö
2. –í–æ–∑–º–æ–∂–Ω–æ: –¥–æ–±–∞–≤–∏—Ç—å "–†–∞–∑–¥–µ–ª–∏—Ç—å –±–ª–æ–∫" (split block at cursor)
3. –í–æ–∑–º–æ–∂–Ω–æ: drag & drop –º–µ–∂–¥—É —Å—Ü–µ–Ω–∞–º–∏

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ. –°–∏—Å—Ç–µ–º–∞ —Ä—É—á–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ –∏ –¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞. –û—Ç–∫–∞–∑ –æ—Ç AI —Ä–∞–∑–º–µ—Ç–∫–∏ –±—ã–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º ‚Äî –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.
