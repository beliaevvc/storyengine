# Рефлексия: DB-001 — Переименование и удаление сущностей

**Дата:** 2026-01-18  
**Уровень:** 2 (Basic Enhancement)  
**Статус:** ✅ Завершено

---

## Краткое описание

Добавлена функциональность переименования и удаления сущностей (entities) в двух местах:
1. Левая панель (вкладка Database) — контекстное меню
2. Открытые документы сущностей — редактируемый заголовок

---

## Что прошло хорошо

### 1. Повторное использование паттернов
- Контекстное меню в `EntityListItem` было реализовано по образцу уже существующего `FileTreeItem`
- Это обеспечило единообразие UX между файлами и сущностями

### 2. Существующая инфраструктура
- API уже были готовы: `updateEntity()`, `deleteEntity()`
- Store actions уже существовали: `updateEntity`, `removeEntity`
- Не потребовалось создавать новую серверную логику

### 3. Синхронизация состояния
- При переименовании обновляется: store, открытая вкладка, sidebar
- При удалении: закрывается вкладка, очищается selection, удаляется из store

---

## Сложности

### 1. Стилизация инпутов
- Первая версия инпутов использовала `bg-input` — белый фон на тёмной теме
- Решение: прозрачный фон + нижняя граница (`bg-transparent border-b border-accent`)

### 2. Обработка событий
- Нужно было правильно останавливать propagation при клике на инпут и меню
- `e.stopPropagation()` на input и кнопках меню

---

## Выводы

1. **Единообразие UI** — при добавлении новой функциональности сначала искать аналогичные реализации в проекте
2. **Inline-редактирование** — прозрачный фон + border-bottom лучше вписывается в тёмные темы
3. **Полная синхронизация** — при изменении данных нужно обновлять все зависимые части UI (tabs, sidebar, store)

---

## Изменённые файлы

| Файл | Изменения |
|------|-----------|
| `EntityListItem.tsx` | Контекстное меню, inline-редактирование |
| `EntityList.tsx` | Props для onRename/onDelete |
| `DatabaseTab.tsx` | Обработчики handleRename/handleDelete |
| `EntityEditor.tsx` | Редактируемый заголовок с иконкой |

---

## Следующие шаги

- Рассмотреть добавление confirmation dialog при удалении
- Возможно добавить undo для удаления (soft delete)
