# АРХИВ: DB-001 — Переименование и удаление сущностей

## МЕТАДАННЫЕ

| Поле | Значение |
|------|----------|
| Task ID | DB-001 |
| Дата начала | 2026-01-18 |
| Дата завершения | 2026-01-18 |
| Уровень сложности | 2 (Basic Enhancement) |
| Статус | ✅ ARCHIVED |

---

## КРАТКОЕ ОПИСАНИЕ

Добавлена возможность переименования и удаления сущностей (entities) в интерфейсе StoryEngine:
- В левой панели (вкладка Database) через контекстное меню
- В открытых документах сущностей через редактируемый заголовок

---

## ТРЕБОВАНИЯ

### Исходная проблема
- В левой панели (Database) нельзя было переименовывать и удалять объекты
- В открытых документах сущностей название было нередактируемым

### Ожидаемый результат
- Контекстное меню с опциями "Переименовать" и "Удалить" для сущностей в sidebar
- Возможность редактировать название сущности в заголовке документа
- Синхронизация изменений между sidebar, вкладками и store

---

## РЕАЛИЗАЦИЯ

### Изменённые файлы

#### 1. `src/presentation/components/explorer/EntityListItem.tsx`
- Добавлено контекстное меню (правый клик + кнопка "...")
- Добавлен режим inline-редактирования названия
- Стили: прозрачный фон + нижняя граница для тёмной темы

#### 2. `src/presentation/components/explorer/EntityList.tsx`
- Добавлены props: `onRename`, `onDelete`
- Проброс обработчиков в EntityListItem

#### 3. `src/presentation/components/explorer/DatabaseTab.tsx`
- Добавлены store actions: `updateEntityInStore`, `removeEntityFromStore`, `closeTab`, `updateTabTitle`
- Реализован `handleRename()` — обновление в БД и store
- Реализован `handleDelete()` — удаление из БД, закрытие вкладки, очистка selection

#### 4. `src/presentation/components/editor/EntityEditor.tsx`
- Добавлено состояние для редактирования названия
- Добавлен input с прозрачным фоном и нижней границей
- Иконка карандаша при наведении на заголовок
- Автоматическое обновление вкладки при изменении названия

### Используемые API
- `updateEntity(entityId, { name })` — переименование
- `deleteEntity(entityId, projectId)` — удаление

### Паттерн реализации
Контекстное меню скопировано с `FileTreeItem.tsx` для единообразия UX.

---

## ТЕСТИРОВАНИЕ

### Ручное тестирование
- [x] Переименование через контекстное меню в sidebar
- [x] Удаление через контекстное меню в sidebar
- [x] Переименование через клик на заголовок в документе
- [x] Синхронизация названия во вкладке при переименовании
- [x] Закрытие вкладки при удалении сущности
- [x] Отмена редактирования по Escape
- [x] Сохранение по Enter и blur

---

## ВЫВОДЫ

1. **Повторное использование паттернов** — поиск аналогичных реализаций в проекте ускоряет разработку
2. **Стилизация для тёмных тем** — `bg-transparent` + `border-b` лучше чем `bg-input`
3. **Полная синхронизация** — при изменении данных обновлять все зависимые части UI

---

## ССЫЛКИ

| Документ | Путь |
|----------|------|
| Рефлексия | `reflection/reflection-DB-001.md` |
